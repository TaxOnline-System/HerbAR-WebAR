<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HerbAR – แอปส่องสมุนไพร</title>
<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.js"></script>
<style>
  html,body{margin:0;height:100%;background:#000;font-family:ui-sans-serif;}
  #ar-container{position:fixed;inset:0;}
  .hud{position:fixed;left:0;right:0;top:0;z-index:20;pointer-events:none;}
  .panel{pointer-events:auto;background:rgba(255,255,255,.92);padding:10px 12px;margin:10px;border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,.16);}
  .toast{position:fixed;bottom:16px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.75);color:#fff;padding:10px 14px;border-radius:12px;z-index:30;}
  .hidden{display:none;}
  button{border-radius:10px;border:1px solid #e5e7eb;background:#fff;padding:8px 12px;margin-right:8px;}
  button:hover{background:#f3f4f6;}
  input[type="file"]{margin-top:6px;}
  dialog{border:none;border-radius:16px;padding:0;max-width:640px;width:92%;}
  dialog::backdrop{background:rgba(0,0,0,.45);}
  .modal-body{padding:12px 16px;}
  .modal-footer{border-top:1px solid #e5e7eb;padding:10px 16px;text-align:right;}
</style>
</head>
<body>

<div class="hud">
  <div class="panel">
    <div style="font-weight:600">HerbAR · สาธิต WebAR</div>
    <div style="font-size:12px;color:#374151">
      ส่อง marker (ไฟล์ .patt ใน /assets) เพื่อดูข้อมูลสมุนไพร
    </div>
  </div>

  <div id="infoPanel" class="panel hidden" style="max-width:560px;">
    <div style="display:flex; gap:12px; align-items:flex-start;">
      <img id="herbImg" src="" alt="herb" style="width:64px;height:64px;object-fit:cover;border-radius:12px;border:1px solid #e5e7eb"/>
      <div style="flex:1">
        <div id="herbSci" style="font-size:12px;color:#6b7280">ชื่อวิทยาศาสตร์</div>
        <div id="herbName" style="font-size:18px;font-weight:800">สมุนไพร</div>
        <div id="herbUses" style="font-size:12px;color:#374151">สรรพคุณ</div>
      </div>
    </div>
    <div style="margin-top:8px;">
      <button id="btnHow">วิธีใช้</button>
      <button id="btnWarn">ข้อห้าม/ขนาดที่เหมาะสม</button>
      <input type="file" id="uploadImg" accept="image/*">
    </div>
  </div>
</div>

<div id="toast" class="toast hidden">เลื่อนกล้องไปที่ marker เพื่อแสดงข้อมูล…</div>

<div id="ar-container">
<a-scene embedded
         vr-mode-ui="enabled: false"
         renderer="logarithmicDepthBuffer: true; antialias: true"
         arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: true">

  <!-- ตัวอย่าง marker สำหรับสมุนไพรทั้ง 10 ตัว -->
  <a-marker type="pattern" url="assets/hiro.patt" id="marker-hiro"></a-marker>
  <a-marker type="pattern" url="assets/kanji.patt" id="marker-kanji"></a-marker>
  <a-marker type="pattern" url="assets/galangal.patt" id="marker-galangal"></a-marker>
  <a-marker type="pattern" url="assets/lemongrass.patt" id="marker-lemongrass"></a-marker>
  <a-marker type="pattern" url="assets/fingerroot.patt" id="marker-fingerroot"></a-marker>
  <a-marker type="pattern" url="assets/pandan.patt" id="marker-pandan"></a-marker>
  <a-marker type="pattern" url="assets/stevia.patt" id="marker-stevia"></a-marker>
  <a-marker type="pattern" url="assets/indianGooseberry.patt" id="marker-indianGooseberry"></a-marker>
  <a-marker type="pattern" url="assets/gotuKola.patt" id="marker-gotuKola"></a-marker>
  <a-marker type="pattern" url="assets/mint.patt" id="marker-mint"></a-marker>

  <a-entity camera></a-entity>
</a-scene>
</div>

<dialog id="modal">
  <div class="modal-body">
    <div id="modalTitle" style="font-size:18px;font-weight:800">รายละเอียด</div>
    <div id="modalBody" style="font-size:14px;color:#374151;margin-top:6px"></div>
  </div>
  <div class="modal-footer">
    <button onclick="modal.close()">ปิด</button>
  </div>
</dialog>

<script>
const HERB_DB = {
  hiro:{name:'กะเพรา',sci:'Ocimum tenuiflorum',img:'https://images.unsplash.com/photo-1582515073490-39981397dfd2?q=80&w=400',uses:'บรรเทาท้องอืด',how:'ใช้ใบสดชงน้ำร้อน',warn:'สตรีมีครรภ์ระวัง',dose:'วันละ 1–2 แก้ว'},
  kanji:{name:'ขิง',sci:'Zingiber officinale',img:'https://images.unsplash.com/photo-1601000938259-9a22507d61dd?q=80&w=400',uses:'แก้อาการคลื่นไส้',how:'ต้มน้ำ 250 มล. 5–10 นาที',warn:'โรคกระเพาะควรระวัง',dose:'1–2 กรัม/วัน'},
  galangal:{name:'ข่า',sci:'Alpinia galanga',img:'https://images.unsplash.com/photo-1615485296740-03ff2cf14e1d?q=80&w=400',uses:'แก้ท้องอืด',how:'ฝานเหง้าสด ต้มน้ำ',warn:'โรคกระเพาะควรระวัง',dose:'ไม่เกิน 2 แก้ว'},
  lemongrass:{name:'ตะไคร้',sci:'Cymbopogon citratus',img:'https://images.unsplash.com/photo-1588628566587-dbd0e0d4f40c?q=80&w=400',uses:'ขับลม ลดอาการท้องอืด',how:'ทุบลำต้น ต้มน้ำ',warn:'ความดันต่ำใช้พอเหมาะ',dose:'ไม่เกิน 500 มล./วัน'},
  fingerroot:{name:'กระชาย',sci:'Boesenbergia rotunda',img:'https://images.unsplash.com/photo-1625577168532-b99b0401d233?q=80&w=400',uses:'บำรุงกำลัง',how:'ฝานรากสด ต้มน้ำ',warn:'โรคไตควรระวัง',dose:'ไม่เกิน 20 กรัม'},
  pandan:{name:'ใบเตย',sci:'Pandanus amaryllifolius',img:'https://images.unsplash.com/photo-1617981681924-41c8a4f39c4e?q=80&w=400',uses:'ช่วยให้กลิ่นหอม',how:'ใบสด ต้มกับน้ำ',warn:'ความดันต่ำควรระวัง',dose:'ไม่เกิน 1 ลิตร'},
  stevia:{name:'หญ้าหวาน',sci:'Stevia rebaudiana',img:'https://images.unsplash.com/photo-1590000196460-bcda4bb2d4dd?q=80&w=400',uses:'ให้ความหวานแทนน้ำตาล',how:'ใบชงน้ำร้อน',warn:'แพ้พืชตระกูลเดียวกันควรระวัง',dose:'ไม่เกิน 4 มก./กก.น้ำหนักตัว/วัน'},
  indianGooseberry:{name:'มะขามป้อม',sci:'Phyllanthus emblica',img:'https://images.unsplash.com/photo-1627322554447-4b921f5d2d14?q=80&w=400',uses:'บำรุงร่างกาย',how:'รับประทานสด ดอง น้ำคั้น',warn:'โรคนิ่วควรระวัง',dose:'วันละไม่เกิน 3 ผล'},
  gotuKola:{name:'ใบบัวบก',sci:'Centella asiatica',img:'https://images.unsplash.com/photo-1622678161780-0bc105b9566e?q=80&w=400',uses:'แก้อักเสบ',how:'คั้นน้ำดื่ม หรือกินสด',warn:'ไม่ควรใช้ต่อเนื่องเกิน 6 สัปดาห์',dose:'น้ำคั้นไม่เกิน 1 แก้ว/วัน'},
  mint:{name:'สะระแหน่',sci:'Mentha spicata',img:'https://images.unsplash.com/photo-1600741258332-63c3d2c6e7db?q=80&w=400',uses:'ลดอาการจุกเสียด',how:'ใช้สดเป็นเครื่องดื่ม',warn:'แพ้ควรระวัง',dose:'ไม่เกิน 5 กรัม/วัน'}
};

const infoPanel = document.getElementById('infoPanel');
const herbImg = document.getElementById('herbImg');
const herbSci = document.getElementById('herbSci');
const herbName = document.getElementById('herbName');
const herbUses = document.getElementById('herbUses');
const btnHow = document.getElementById('btnHow');
const btnWarn = document.getElementById('btnWarn');
const toast = document.getElementById('toast');
const modal = document.getElementById('modal');
const modalTitle = document.getElementById('modalTitle');
const modalBody = document.getElementById('modalBody');
const uploadImg = document.getElementById('uploadImg');
let currentKey = null;

function showToast(msg){
  toast.textContent=msg; toast.classList.remove('hidden');
  clearTimeout(showToast._t); showToast._t=setTimeout(()=>toast.classList.add('hidden'),1800);
}

function setHerb(key){
  const h=HERB_DB[key]; if(!h) return;
  currentKey=key; herbImg.src=h.img; herbSci.textContent=h.sci;
  herbName.textContent=h.name; herbUses.textContent=h.uses;
  infoPanel.classList.remove('hidden');
}
function clearHerb(){currentKey=null; infoPanel.classList.add('hidden'); herbImg.src='';}

Object.keys(HERB_DB).forEach(key=>{
  const marker=document.getElementById(`marker-${key}`);
  if(!marker) return;
  marker.addEventListener('markerFound',()=>{setHerb(key); showToast(`พบ marker: ${HERB_DB[key].name}`);});
  marker.addEventListener('markerLost',()=>{clearHerb(); showToast('marker หายไป');});
});

document.addEventListener('click',()=>{
  const video=document.querySelector('video'); if(video&&video.paused) video.play().catch(()=>{});
},{once:true});

btnHow.addEventListener('click',()=>{
  if(!currentKey) return;
  const h=HERB_DB[currentKey];
  modalTitle.textContent=`วิธีใช้: ${h.name}`;
  modalBody.textContent=h.how; modal.showModal();
});
btnWarn.addEventListener('click',()=>{
  if(!currentKey) return;
  const h=HERB_DB[currentKey];
  modalTitle.textContent=`ข้อห้าม/ขนาดที่เหมาะสม: ${h.name}`;
  modalBody.innerHTML=`<div style='margin-bottom:6px'>${h.warn}</div><div style='font-weight:700;color:#111'>ขนาดที่เหมาะสม: ${h.dose}</div>`;
  modal.showModal();
});
uploadImg.addEventListener('change',e=>{
  const file=e.target.files[0]; if(!file) return;
  const reader=new FileReader();
  reader.onload=function(evt){herbImg.src=evt.target.result;};
  reader.readAsDataURL(file);
});
</script>

</body>
</html>
