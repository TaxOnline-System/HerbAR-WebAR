<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
<title>HerbAR – แอปส่องสมุนไพร (WebAR)</title>
<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.js"></script>
<style>
  html, body { margin:0; height:100%; background:#000; font-family:ui-sans-serif,sans-serif;}
  #ar-container { position: fixed; inset:0; border:4px solid #16a34a; border-radius:16px; overflow:hidden;}
  #infoPanel {
    position: fixed; bottom: 20px; left:50%; transform: translateX(-50%);
    width:90%; max-width:500px; background: rgba(255,255,255,0.95);
    border-radius:16px; padding:12px; box-shadow:0 8px 24px rgba(0,0,0,0.2);
    display:flex; flex-direction:column; gap:8px; z-index:20; pointer-events:auto;
  }
  #infoPanel.hidden { display:none; }
  #herbImg { width:80px;height:80px;border-radius:12px;border:2px solid #16a34a; object-fit:cover;}
  .info-text div { margin-bottom:4px; }
  .btn-group { display:flex; gap:8px; margin-top:8px; flex-wrap:wrap; }
  .btn { border-radius:12px; border:1px solid #16a34a; background:#fff; padding:8px 14px; font-weight:600; cursor:pointer; transition:0.2s; }
  .btn:hover { background:#dcfce7; }
  #toast { position:fixed; top:16px; left:50%; transform:translateX(-50%);
    background:rgba(0,0,0,0.75); color:#fff; padding:10px 14px; border-radius:12px; z-index:30; }
  dialog { border:none; border-radius:16px; padding:0; max-width:640px; width:92%; }
  dialog::backdrop { background: rgba(0,0,0,0.45); }
  .modal-body { padding:16px; }
  .modal-footer { border-top:1px solid #e5e7eb; padding:10px; text-align:right; }
</style>
</head>
<body>
<div id="ar-container">
  <a-scene embedded vr-mode-ui="enabled:false" renderer="logarithmicDepthBuffer:true; antialias:true"
           arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;">
    <a-marker preset="hiro" id="marker-hiro"></a-marker>
    <a-marker preset="kanji" id="marker-kanji"></a-marker>
    <a-marker preset="kanji" id="marker-galangal"></a-marker>
    <a-marker preset="kanji" id="marker-lemongrass"></a-marker>
    <a-marker preset="kanji" id="marker-fingerroot"></a-marker>
    <a-marker preset="kanji" id="marker-pandan"></a-marker>
    <a-marker preset="kanji" id="marker-stevia"></a-marker>
    <a-marker preset="kanji" id="marker-indianGooseberry"></a-marker>
    <a-marker preset="kanji" id="marker-gotuKola"></a-marker>
    <a-marker preset="kanji" id="marker-lime"></a-marker>
    <a-entity camera></a-entity>
  </a-scene>
</div>

<div id="infoPanel" class="hidden">
  <div style="display:flex; gap:12px; align-items:center;">
    <img id="herbImg" src="" alt="herb"/>
    <div class="info-text">
      <div id="herbName" style="font-size:18px;font-weight:800;">สมุนไพร</div>
      <div id="herbSci" style="font-size:12px;color:#6b7280;">ชื่อวิทยาศาสตร์</div>
      <div id="herbUses" style="font-size:14px;color:#374151;">สรรพคุณ</div>
    </div>
  </div>
  <div class="btn-group">
    <button id="btnHow" class="btn">วิธีใช้</button>
    <button id="btnWarn" class="btn">ข้อห้าม/ขนาด</button>
    <input type="file" id="uploadImg" accept="image/*" class="btn"/>
  </div>
</div>

<div id="toast" class="hidden"></div>

<dialog id="modal">
  <div class="modal-body">
    <div id="modalTitle" style="font-size:18px;font-weight:800">รายละเอียด</div>
    <div id="modalBody" style="font-size:14px;color:#374151;margin-top:6px"></div>
  </div>
  <div class="modal-footer">
    <button onclick="modal.close()" class="btn">ปิด</button>
  </div>
</dialog>

<script>
const HERB_DB = {
  hiro:{name:'กะเพรา',sci:'Ocimum tenuiflorum',img:'https://images.unsplash.com/photo-1582515073490-39981397dfd2?q=80&w=400&auto=format&fit=crop',uses:'บรรเทาท้องอืด แน่นเฟ้อ แก้คลื่นไส้ ช่วยขับลม',how:'ใช้ใบสดชงน้ำร้อนดื่ม หรือผัดเป็นอาหาร',warn:'สตรีมีครรภ์ควรหลีกเลี่ยงการใช้ปริมาณมาก',dose:'วันละ 1–2 แก้ว'},
  kanji:{name:'ขิง',sci:'Zingiber officinale',img:'https://images.unsplash.com/photo-1601000938259-9a22507d61dd?q=80&w=400&auto=format&fit=crop',uses:'แก้อาการคลื่นไส้ เมารถ เมาเรือ อุ่นร่างกาย ช่วยย่อย',how:'ต้มน้ำ 250 มล. 5–10 นาที ดื่มอุ่น ๆ',warn:'ผู้ที่เป็นแผลในกระเพาะควรปรึกษาแพทย์',dose:'ผงขิง 1–2 กรัม/วัน'},
  galangal:{name:'ข่า',sci:'Alpinia galanga',img:'https://images.unsplash.com/photo-1615485296740-03ff2cf14e1d?q=80&w=400&auto=format&fit=crop',uses:'แก้ท้องอืด ขับลม แก้ปวดท้อง',how:'ฝานเหง้าสด 3–4 แว่น ต้มน้ำ 250 มล. 5–7 นาที ดื่มอุ่น ๆ',warn:'ผู้ป่วยโรคกระเพาะควรระวัง',dose:'ไม่เกิน 2 แก้ว/วัน'},
  lemongrass:{name:'ตะไคร้',sci:'Cymbopogon citratus',img:'https://images.unsplash.com/photo-1588628566587-dbd0e0d4f40c?q=80&w=400&auto=format&fit=crop',uses:'ขับลม ลดอาการท้องอืด ช่วยขับปัสสาวะ',how:'ทุบลำต้น 2–3 ต้น ต้มน้ำ 300 มล. 5 นาที',warn:'ผู้ที่มีความดันโลหิตต่ำควรใช้พอเหมาะ',dose:'ไม่เกิน 500 มล./วัน'},
  fingerroot:{name:'กระชาย',sci:'Boesenbergia rotunda',img:'https://images.unsplash.com/photo-1625577168532-b99b0401d233?q=80&w=400&auto=format&fit=crop',uses:'บำรุงกำลัง ขับลม แก้ท้องอืด',how:'ฝานรากสด 5–10 กรัม ต้มน้ำดื่ม หรือบดผสมอาหาร',warn:'ผู้ป่วยโรคไตควรหลีกเลี่ยงการใช้ต่อเนื่องนาน',dose:'วันละไม่เกิน 20 กรัม'},
  pandan:{name:'ใบเตย',sci:'Pandanus amaryllifolius',img:'https://images.unsplash.com/photo-1617981681924-41c8a4f39c4e?q=80&w=400&auto=format&fit=crop',uses:'ช่วยให้กลิ่นหอม ผ่อนคลาย ลดความดันเล็กน้อย',how:'ใบสด 5–7 ใบ ต้มกับน้ำ 500 มล. ดื่มหรือใช้แต่งกลิ่น',warn:'ความดันต่ำไม่ควรดื่มมากเกินไป',dose:'ไม่เกิน 1 ลิตร/วัน'},
  stevia:{name:'หญ้าหวาน',sci:'Stevia rebaudiana',img:'https://images.unsplash.com/photo-1590000196460-bcda4bb2d4dd?q=80&w=400&auto=format&fit=crop',uses:'ให้ความหวานแทนน้ำตาล ลดพลังงาน',how:'ใช้ใบแห้งหรือสดชงน้ำร้อนแทนน้ำตาล',warn:'ผู้ที่แพ้พืชตระกูลเดียวกันควรระวัง',dose:'ไม่เกิน 4 มก./กก.น้ำหนักตัว/วัน'},
  indianGooseberry:{name:'มะขามป้อม',sci:'Phyllanthus emblica',img:'https://images.unsplash.com/photo-1627322554447-4b921f5d2d14?q=80&w=400&auto=format&fit=crop',uses:'บำรุงร่างกาย แก้ไอ เสริมภูมิคุ้มกัน',how:'รับประทานสด ดอง หรือน้ำคั้น',warn:'ผู้ที่เป็นโรคนิ่วในไตควรระวัง',dose:'วันละไม่เกิน 3 ผลสด'},
  gotuKola:{name:'ใบบัวบก',sci:'Centella asiatica',img:'https://images.unsplash.com/photo-1622678161780-0bc105b9566e?q=80&w=400&auto=format&fit=crop',uses:'แก้อักเสบ บำรุงสมอง ลดความเครียด',how:'คั้นน้ำดื่ม หรือกินสดเป็นผักแนม',warn:'ไม่ควรใช้ต่อเนื่องนานเกิน 6 สัปดาห์',dose:'น้ำคั้นไม่เกิน 1 แก้ว/วัน'},
  lime:{name:'มะนาว',sci:'Citrus aurantiifolia',img:'https://images.unsplash.com/photo-1601000012395-2f9f4b3d52c1?q=80&w=400&auto=format&fit=crop',uses:'เพิ่มรสชาติ แก้ท้องอืด',how:'บีบลงในน้ำดื่มหรืออาหาร',warn:'ควรใช้พอเหมาะกับผู้แพ้กรด',dose:'ไม่เกิน 2 ผล/วัน'}
};

const infoPanel = document.getElementById('infoPanel');
const herbImg = document.getElementById('herbImg');
const herbSci = document.getElementById('herbSci');
const herbName = document.getElementById('herbName');
const herbUses = document.getElementById('herbUses');
const btnHow = document.getElementById('btnHow');
const btnWarn = document.getElementById('btnWarn');
const toast = document.getElementById('toast');
const modal = document.getElementById('modal');
const modalTitle = document.getElementById('modalTitle');
const modalBody = document.getElementById('modalBody');
const uploadImg = document.getElementById('uploadImg');
let currentKey = null;

function showToast(msg){
  toast.textContent = msg;
  toast.classList.remove('hidden');
  clearTimeout(showToast._t);
  showToast._t = setTimeout(()=>toast.classList.add('hidden'),1800);
}

function setHerb(key){
  const h = HERB_DB[key];
  if(!h) return;
  currentKey = key;
  herbImg.src = h.img;
  herbSci.textContent = h.sci;
  herbName.textContent = h.name;
  herbUses.textContent = h.uses;
  infoPanel.classList.remove('hidden');
}

function clearHerb(){ currentKey=null; infoPanel.classList.add('hidden'); herbImg.src=''; }

Object.keys(HERB_DB).forEach(key=>{
  const marker = document.getElementById('marker-'+key);
  if(marker){
    marker.addEventListener('markerFound',()=>{ setHerb(key); showToast('พบ marker: '+HERB_DB[key].name); });
    marker.addEventListener('markerLost',()=>{ clearHerb(); showToast('marker หายไป'); });
  }
});

btnHow.addEventListener('click',()=>{
  if(!currentKey) return;
  const h = HERB_DB[currentKey];
  modalTitle.textContent = `วิธีใช้: ${h.name}`;
  modalBody.textContent = h.how;
  modal.showModal();
});

btnWarn.addEventListener('click',()=>{
  if(!currentKey) return;
  const h = HERB_DB[currentKey];
  modalTitle.textContent = `ข้อห้าม/ขนาดที่เหมาะสม: ${h.name}`;
  modalBody.innerHTML = `<div style='margin-bottom:6px'>${h.warn}</div><div style='font-weight:700;color:#111'>ขนาดที่เหมาะสม: ${h.dose}</div>`;
  modal.showModal();
});

uploadImg.addEventListener('change',(e)=>{
  const file=e.target.files[0]; if(!file) return;
  const reader=new FileReader();
  reader.onload=function(evt){ herbImg.src=evt.target.result; };
  reader.readAsDataURL(file);
});

document.addEventListener('click',()=>{
  const video = document.querySelector('video');
  if(video && video.paused) video.play().catch(()=>{});
},{once:true});
</script>
</body>
</html>
